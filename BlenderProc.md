# 合成を“よりリアルっぽく"するために

- 1.床/棚/壁の背景テクスチャ（現地の材質っぽいものをランダム化）
- 2.照明（色温度・方向・強さ・複数ライト・影）
- 3.カメラ（露出/ゲイン相当、ホワイトバランス相当、ブレ/ボケ、歪み）
- 4.雑多物体（clutter）（未ラベルの“邪魔物”を入れて頑健化）
- 5.反射・ツヤ（箱/缶の“ハイライト地獄”を再現）

## 1) 背景：床/棚/壁を「会場っぽく」する
### 背景素材の用意（おすすめ運用）
- assets/textures/ に床・木目・白壁・黒テーブル・カーペット等の画像を放り込む
（最低でも 20〜50枚あると効きます）

- “会場っぽい”のはだいたいこれ：
  - 床：フローリング/カーペット/灰色樹脂/コンクリ
  - 棚：白い板/木目/メラミン板
  - 壁：白/薄グレー

### BlenderProc側のやり方（概念）
- 1枚の平面で済ませず、**床＋壁（L字）**や、**棚板（水平板＋背板）**のテンプレを用意して、毎フレームランダム化。

- テクスチャは「貼るだけ」ではなく、
  - スケール（タイルサイズ）
  - 回転
  - 明るさ
  - 軽い汚れ/ノイズ
を揺らすと一気に現実っぽくなります。

## 2) 照明：色温度・方向・強さ・複数ライト・影
会場では「影」「反射」「色温度ズレ」で落ちます。照明はここを狙って揺らします。

### 照明のランダム化（おすすめ範囲）
- 色温度っぽさ（白→黄→青）：
実装は “ライト色” をランダムに振る（白色点をずらす）
  - 例：R,G,B をそれぞれ 0.85〜1.15 程度で揺らす（最後に正規化）
- キーライト（主光源）：
  - 位置：カメラの斜め上（左右どちらか）＋距離ランダム
  - 強さ：広く（暗い会場もある）
- フィルライト（弱い補助）：
  - 反対側から弱めに入れる（影の濃さをコントロール）
- バックライト（逆光）：
  - たまに入れる（頻度10〜20%） → 逆光耐性が上がる
- 影：
  - ライトを点光源だけにせず、エリアライトも混ぜる（影の硬さが変わる）

ポイント：照明を“派手に”振るほど、現地の照明変動に強くなります。

## 3) カメラ：露出/ゲイン、ボケ、ブレ、歪み（RoboCupで効く順）
### A. 露出/ゲイン相当（最重要）
実カメラは自動露出でフレームごとに揺れるので、合成でも揺らします。
- 画像全体の 明るさ/コントラスト/ガンマ をランダム（レンダ後の簡単な色調変換でOK）
  - 明るさ：0.7〜1.3
  - コントラスト：0.8〜1.2
  - ガンマ：0.8〜1.2

### B. モーションブラー（移動中のロボット対策）
- 低頻度（20〜40%）で入れると強いです
- “少しだけブレる”レベルが現地に効く（ブレ過ぎは逆効果）

### C. 被写界深度（ボケ）
- 近距離把持でボケるカメラなら必須
- 「たまに」入れる（10〜30%）

### D. レンズ歪み
- 広角USBカメラやRealSense系の歪みがあると誤差が出るので、軽く入れる
- k1/k2を微小に（やりすぎない）

### E. ローリングシャッター“っぽさ”
Blenderで厳密再現は重いので、まずは
- 縦方向の微小シア＋軽いブレ
- ライン状ノイズ（弱）
で“っぽさ”を出す程度で十分です（本気でやるのは最後でOK）。

## 4) 雑多物体（clutter）：未ラベルの邪魔物を混ぜる
RoboCup会場は「背景がうるさい」が普通です。合成でも再現します。

### 手軽で効く2パターン
- ランダム形状プリミティブ（箱・円柱・球）を数個置く
→ “箱っぽい背景” に対して過検出が減る

- YCBの別物体を “distractor” として置く（未ラベル）
→ ただし将来その物体を識別したいなら、後で学習クラスに入れる前提で

注意：未ラベル物体を混ぜると「それは背景」と学習します。
将来その物体も検出したいなら、最終的にはラベル付きで学習し直すのが安全です。

## 5) 反射・ツヤ：cracker box / 缶の“ハイライト地獄”を作る
現地で落ちるのは、だいたいここです。

### 効くこと
- 環境光（HDRIっぽい） を入れる／背景色を単色にしない
- マテリアル側で
  - specular（鏡面）を少し上げる
  - roughness（粗さ）を広くランダム化（0.05〜0.6くらい）
- さらに 光源の位置を大きく振る（ハイライト位置が変わる）

テクスチャが薄い/無いように見えた件も、反射成分の調整で「白飛び」すると起きます。
なので “ツヤを上げる” と同時に “露出・ライト強度” も揺らすのがセットです。

